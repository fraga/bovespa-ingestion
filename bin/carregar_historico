#!/usr/bin/env ruby
$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)
require 'historico_ativos'

module HistoricoAtivos

  if ARGV.size <= 0
    puts "Uso: carregar_historico [nome do arquivo]"
    puts "     exemplo: carregar_historico sample/sample_cota_hist_2003.txt"
  else
    sample_file = ARGV[0]

    puts "Carregando historico do arquivo: #{sample_file}"

    start_time = Time.now
    
    loader = CarregaHistorico.new ParserHeader.new, ParserTrailer.new, ParserAtivo.new
    historico = loader.load sample_file 

    puts "Total de ativos carregados: #{historico.ativos.length}"

    loader.persist historico

    end_time = Time.now 
    elapsed_time = (end_time - start_time) * 1000.0

    puts "Historico carregado em #{elapsed_time} ms!"
  end

end
